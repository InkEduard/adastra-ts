const f=(n,h=2,c=",",d=".")=>{if(isNaN(n)||n==null)return 0;n=(n/100).toFixed(h);const u=n.split("."),t=u[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+c),i=u[1]?d+u[1]:"";return t+i},k=(n,h="${{amount}}")=>{let c;const d=/\{\{\s*(\w+)\s*\}\}/;switch(typeof n=="string"&&(n=n.replace(".","")),h.match(d)[1]){case"amount":c=f(n,2);break;case"amount_no_decimals":c=f(n,0);break;case"amount_with_comma_separator":c=f(n,2,".",",");break;case"amount_no_decimals_with_comma_separator":c=f(n,0,".",",");break}return h.replace(d,c)},g=n=>{n.data("variants",(h,c,d,u)=>({isValid:!0,productId:h,optionsCount:c,productUrl:d,options:{},variantData:[],hoverImage:"",variantsImages:[],currentColorImages:[],currentVariant:{},availableVariants:[],initedSingleOptions:[],backInStockDates:"",prefix:u,init(){const t=document.querySelector(`[x-ref="variants-data-${this.productId}"]`),i=document.querySelector(`[x-ref="variants-images-${this.productId}"]`),s=document.querySelector(`[x-ref="variants-back-in-stock-date-${this.productId}"]`);t&&(this.variantData=JSON.parse(t.innerText)),i&&(this.variantsImages=JSON.parse(i.innerText)),s&&u==="main"&&(this.$store.productStatus.updateBackInStockDates(s.innerText),this.backInStockDates=s.innerText),this.addAvailableVariants(),this.productUrl&&this.updateURL()},addAvailableVariants(){let t=[];const i=[];this.variantData.forEach(s=>t.push(...s.options)),t=[...new Set(t)],u==="main"?t.forEach((s,o)=>{this.variantData.filter(e=>e.options.includes(s)&&e.available).length&&i.push(s)}):i.push(...t),this.availableVariants.push(...i)},addImages(t){const i=[];t?(this.variantsImages.forEach(s=>{if(i.length)return;const o="featured_image",a="gallery";if(s[o])for(const e in s[o])e.split(",").filter(l=>l!=="").includes(t)&&i.push(s[o][e]);if(s[a])for(const e in s[a])e.split(",").filter(l=>l!=="").includes(t)&&i.push(s[a][e])}),this.currentColorImages=[],this.currentColorImages.push(...i)):this.currentColorImages=[]},getOptionsLength(t){return t.reduce((i,s)=>Math.max(i,s.options.length),0)},onVariantChange(t,i,s,o){const a=this.getOptionsLength(this.variantData);this.options[t]&&this.options[t]===i?delete this.options[t]:this.options[t]=i;const e=Object.keys(this.options).length;this.options=Object.fromEntries(Object.entries(this.options).sort()),this.setCurrentVariant(this.variantData),e?(this.updateVariantStatuses(this.variantData),s.includes("color")&&this.addImages(i)):(this.addAvailableVariants(),this.addImages(null)),this.productUrl&&this.updateURL(),o==="main"&&this.updateProductStatus(a,e)},updateProductStatus(t,i){if(t===i)if(this.currentVariant){const s=this.$store.productStatus.getBackInStockDates()[this.currentVariant.id];this.setProductStatus(!this.currentVariant.available,s)}else this.setProductStatus(!0,null);else this.resetProductStatus()},resetProductStatus(){this.$store.productStatus.isOutOfStock=!1,this.$store.productStatus.backInStockDate=null},setProductStatus(t,i){this.$store.productStatus.isOutOfStock=t,this.$store.productStatus.backInStockDate=i},setCurrentVariant(t){this.currentVariant=t.find(i=>!i.options.map((s,o)=>this.options[`option${o+1}`]===s).includes(!1))},updateVariantStatuses(t){const i=Object.values(this.options),s=[],o=this.backInStockDates?this.$store.productStatus.getBackInStockDates():{};s.push(...i),t.forEach(a=>{for(const r in this.options){const l=a[r];let p=JSON.parse(JSON.stringify(this.options));p[r]=l,p=Object.values(p),p.every(S=>a.options.includes(S))&&(!s.includes(l)&&a.available||!a.available&&o.hasOwnProperty(a.id)&&u==="main")&&s.push(l)}const e=i.every(r=>a.options.includes(r));(e&&a.available||e&&u==="main"&&o.hasOwnProperty(a.id))&&a.options.forEach(r=>{s.includes(r)||s.push(r)})}),this.availableVariants=[],this.availableVariants.push(...s)},isChecked(t,i,s,o,a,e){const r=`${t}-${i}-${s}`;return o===1&&!this.initedSingleOptions.includes(r)&&(this.initedSingleOptions.push(r),this.onVariantChange(`option${i}`,s,a,e)),this.options[`option${i}`]===s},getPrice(t){return t?k(t):""},updateURL(){const t=this.currentVariant&&this.currentVariant.id?`${this.productUrl}?variant=${this.currentVariant.id}`:this.productUrl;window.history.replaceState({},"",t)}}))};export{g as default};
